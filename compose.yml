---
# Builds and runs the Thorlabs T/KCube control services
name: ablation_aim

services:
    y_control:
        container_name: kdc101_y
        restart: always
        ports:
            - 3255:3255
        devices:
            - /dev/kdc101_0:/dev/ttyUSB0
        networks:
            - thorlabs_cube
        build:
            context: ./
            dockerfile: ./Dockerfile
        entrypoint: [aqctl_thorlabs_cube]
        command: [-p, '3255', -P, kdc101, -d, /dev/ttyUSB0, --bind, '*']

    z_control:
        container_name: kdc101_z
        restart: always
        ports:
            - 3256:3255
        devices:
            - /dev/kdc101_1:/dev/ttyUSB0
        networks:
            - thorlabs_cube
        build:
            context: ./
            dockerfile: ./Dockerfile
        entrypoint: [aqctl_thorlabs_cube]
        command: [-p, '3255', -P, kdc101, -d, /dev/ttyUSB0, --bind, '*']

    kpa101:
        container_name: kpa101
        restart: always
        ports:
            - 3256:3255
        devices:
            - /dev/ttyUSB0
        networks:
            - thorlabs_cube
        build:
            context: ./
            dockerfile: ./Dockerfile
        entrypoint: [aqctl_thorlabs_cube]
        command: [-p, '3255', -P, kpa101, -d, /dev/ttyUSB0, --bind, '*']

networks:
    thorlabs_cube:
